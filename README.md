# snRNAseq-workflows

**Languages:** R, Python  
**Frameworks:** Seurat, Harmony, scVI 

This repository contains reproducible **single-nucleus RNA-seq (snRNA-seq) analysis workflows**
used in real research projects. The workflows cover quality control, normalization,
integration, clustering, annotation, and downstream analyses, including
cell-typeâ€“specific subclustering and machine learningâ€“based representations.

The goal of this repository is to demonstrate **practical, research-grade snRNA-seq pipelines**
with an emphasis on:
- biological interpretability
- reproducibility
- clean, modular code

---

## ğŸ“ Repository structure

<pre>
snRNAseq-workflows/
â”œâ”€â”€ data/
â”‚   â””â”€â”€ example_metadata/        # Example metadata tables (no raw sequencing data)
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ 01_qc/                   # QC and filtering
â”‚   â”œâ”€â”€ 02_normalization/        # Normalization and scaling
â”‚   â”œâ”€â”€ 03_integration/          # Dataset integration (Harmony, Seurat)
â”‚   â”œâ”€â”€ 04_clustering/           # Dimensionality reduction and clustering
â”‚   â”œâ”€â”€ 05_annotation/           # Cell type annotation and subclustering
â”‚   â””â”€â”€ 06_downstream/           # DE, pathway analysis, ML, visualization
â”œâ”€â”€ envs/                        # Conda / R environment specifications
â”œâ”€â”€ figures/                     # Generated figures (PNG/PDF)
â”œâ”€â”€ results/                     # Result tables and summaries
â””â”€â”€ README.md
</pre>

---

## ğŸ§¬ Typical workflow

1. **Quality control**
   - Filtering nuclei by counts, features, and mitochondrial content
   - Doublet detection (e.g., SCDS, CellBender, dataset-dependent)

2. **Normalization**
   - Log-normalization or SCTransform
   - Variable feature selection

3. **Integration**
   - Batch correction using Harmony or Seurat integration
   - Support for multi-sample and multi-condition designs

4. **Clustering & visualization**
   - PCA and UMAP
   - Cluster resolution tuning

5. **Annotation**
   - Marker-based cell type annotation
   - Reference-guided approaches when applicable

6. **Downstream analysis**
   - Differential expression (cell-type specific, pseudobulk)
   - Over-representation analysis (GO / KEGG)
   - Gene set enrichment analysis (GSEA)
   - Pathwayâ€“gene network visualization
   - Cell composition analysis
   - Machine-learningâ€“based representations (scVI latent space)

---

## ğŸ”¬ Hepatocyte subclustering

To resolve hepatocyte heterogeneity that is not captured at the global clustering
level, hepatocytes are subclustered in a cell-typeâ€“specific manner.

### Rationale
- Hepatocytes exhibit strong spatial zonation and functional diversity
- Global clustering often masks zonation- and disease-associated states
- Subclustering improves biological resolution without overclustering

### Workflow
1. Subset hepatocytes from an annotated snRNA-seq object
2. Re-normalize and scale within hepatocytes
3. Perform PCA, neighbor graph construction, and UMAP
4. Apply conservative subclustering
5. Annotate subclusters using known zonation and functional markers

---

## ğŸ›  Languages & tools

- **R**
  - Seurat (QC, normalization, clustering, annotation)
  - Harmony (batch correction)
  - ggplot2 (visualization)
  - SCDS (doublet detection, dataset-dependent)

- **Python**
  - scVI (latent space modeling, representation learning)
  - PyTorch backend
  - CellBender (ambient RNA / doublet-aware correction, dataset-dependent)

Tool selection varies by dataset and experimental design.


### Outputs
- Subclustered and annotated hepatocyte Seurat objects (`.rds`)
- Marker gene tables (`.csv`)
- UMAP visualizations (`.png`)

---

## ğŸ¤– Machine learning & latent space modeling (scVI)

This repository includes an optional machine learning module based on **scVI**
(single-cell variational inference), a deep generative model designed for
single-cell and single-nucleus RNA-seq data.

### Rationale
scVI is used to:
- learn low-dimensional latent representations of snRNA-seq data
- mitigate batch effects in a probabilistic framework
- support exploratory visualization and downstream analyses

scVI is used as a **representation-learning tool**, not as a replacement for
biologically interpretable analyses such as differential expression or
marker-based annotation.

---

## ğŸ“Š Example outputs

Example outputs generated by the workflows include:
- UMAP visualizations of cell populations and hepatocyte subclusters
- Marker gene tables for cluster and subcluster annotation
- Cell-type composition summaries
- Latent space embeddings from scVI

Representative figures are stored in the `figures/` directory.

---

## â™»ï¸ Reproducibility & limitations

### Reproducibility
- Scripts are modular and designed to be run sequentially
- Software environments are documented where applicable
- No raw sequencing data are included; users must provide their own inputs

### Limitations
- Parameter choices (e.g., QC thresholds, clustering resolution) are dataset-specific
- Subclustering and annotation require manual biological interpretation
- Machine learning results depend on data size, quality, and model parameters

Users are encouraged to adapt thresholds and parameters to their own datasets
and to validate findings using complementary approaches.

---

## ğŸ” Workflow logic & decision points

The execution order, optional branches, and methodological decisions
(e.g. CellBender vs scds, subclustering strategy, scVI usage)
are documented in:

ğŸ“„ `scripts/workflow_overview.md`

This separation keeps the README concise while preserving full
methodological transparency.

## ğŸ¯ Intended audience

This repository is intended for:
- computational biologists and bioinformaticians
- researchers working with snRNA-seq or scRNA-seq data
- scientists interested in reproducible single-cell workflows

---

## ğŸ‘©â€ğŸ”¬ Author

**Naghmeh Rezaei**  
Computational Biology Â· Single-cell & Spatial Omics Â· Machine Learning
